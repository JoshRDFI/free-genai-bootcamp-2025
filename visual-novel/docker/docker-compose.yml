version: '3.8'

services:
  # Game server / API Gateway
  vn-game-server:
    build:
      context: ../server
    container_name: vn-game-server
    ports:
      - "8080:8080"
    volumes:
      - ../server:/app
      - ${SHARED_DB_PATH:-../opea-docker/data/shared_db}:/app/db
    environment:
      - LLM_TEXT_URL=http://llm_text:9000
      - TTS_URL=http://tts:9200
      - ASR_URL=http://asr:9300
      - LLM_VISION_URL=http://llm-vision:9100
      - EMBEDDINGS_URL=http://embeddings:6000
    depends_on:
      - vn-openvino-service
    networks:
      - vn-network
      - opea-network
    restart: unless-stopped

  # OpenVINO image generation service
  vn-openvino-service:
    build:
      context: ../openvino
    container_name: vn-openvino-service
    ports:
      - "8081:8081"
    volumes:
      - ../openvino:/app
      - ${OPENVINO_MODELS_PATH:-./data/openvino_models}:/app/models
    environment:
      - MODEL_PATH=/app/models
    networks:
      - vn-network
    restart: unless-stopped

  # Web server for Ren'Py web export
  vn-web-server:
    image: nginx:alpine
    container_name: vn-web-server
    ports:
      - "8000:80"
    volumes:
      - ../renpy/web:/usr/share/nginx/html
    networks:
      - vn-network
    restart: unless-stopped

networks:
  vn-network:
    driver: bridge
  opea-network:
    external: true
    name: opea-docker_default  # This should match your existing Docker network name